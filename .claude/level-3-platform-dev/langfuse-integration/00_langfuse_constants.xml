<?xml version="1.0" encoding="UTF-8"?>
<document type="constants" version="1.0.0">
  <metadata>
    <system>Level 3 Platform Development</system>
    <integration>Langfuse Observability</integration>
    <purpose>Centralized constants for Langfuse integration in API-based system</purpose>
    <last-updated>2025-08-12</last-updated>
  </metadata>

  <observability-constants>
    <tracing>
      <flush-at>15</flush-at>
      <flush-interval>0.5</flush-interval>
      <batch-size>20</batch-size>
      <max-retries>3</max-retries>
      <timeout-seconds>30</timeout-seconds>
    </tracing>

    <cost-tracking>
      <target-episode-cost>5.00</target-episode-cost>
      <max-episode-cost>9.00</max-episode-cost>
      <warning-threshold>7.00</warning-threshold>
      <currency>USD</currency>
    </cost-tracking>

    <quality-thresholds>
      <overall>0.85</overall>
      <brand-consistency>0.90</brand-consistency>
      <comprehension>0.85</comprehension>
      <engagement>0.80</engagement>
      <technical-accuracy>0.85</technical-accuracy>
    </quality-thresholds>

    <agent-budgets>
      <research-coordinator>3.00</research-coordinator>
      <script-writer>2.50</script-writer>
      <quality-evaluator>0.50</quality-evaluator>
      <audio-synthesizer>2.00</audio-synthesizer>
      <orchestrator>0.50</orchestrator>
    </agent-budgets>

    <model-selection>
      <research-model>claude-3-sonnet</research-model>
      <writing-model>claude-3-opus</writing-model>
      <evaluation-model>claude-3-haiku</evaluation-model>
      <orchestration-model>claude-3-haiku</orchestration-model>
    </model-selection>

    <token-limits>
      <max-input-tokens>100000</max-input-tokens>
      <max-output-tokens>8192</max-output-tokens>
      <warning-at-percent>80</warning-at-percent>
    </token-limits>
  </observability-constants>

  <langfuse-configuration>
    <endpoints>
      <cloud>https://cloud.langfuse.com</cloud>
      <self-hosted>http://localhost:3000</self-hosted>
    </endpoints>

    <project>
      <name>nobody-knows-podcast</name>
      <environment>production</environment>
      <version>3.0.0</version>
    </project>

    <features>
      <llm-as-judge>true</llm-as-judge>
      <cost-tracking>true</cost-tracking>
      <quality-scoring>true</quality-scoring>
      <performance-monitoring>true</performance-monitoring>
      <error-tracking>true</error-tracking>
      <user-feedback>false</user-feedback>
    </features>
  </langfuse-configuration>

  <metric-definitions>
    <cost-metrics>
      <metric name="input_tokens" unit="tokens" type="counter"/>
      <metric name="output_tokens" unit="tokens" type="counter"/>
      <metric name="total_cost" unit="USD" type="gauge"/>
      <metric name="cost_per_token" unit="USD/token" type="gauge"/>
    </cost-metrics>

    <quality-metrics>
      <metric name="overall_score" unit="ratio" type="gauge" range="0.0-1.0"/>
      <metric name="brand_score" unit="ratio" type="gauge" range="0.0-1.0"/>
      <metric name="comprehension_score" unit="ratio" type="gauge" range="0.0-1.0"/>
      <metric name="engagement_score" unit="ratio" type="gauge" range="0.0-1.0"/>
      <metric name="pass_fail" unit="boolean" type="binary"/>
    </quality-metrics>

    <performance-metrics>
      <metric name="latency" unit="milliseconds" type="histogram"/>
      <metric name="throughput" unit="episodes/hour" type="gauge"/>
      <metric name="retry_count" unit="count" type="counter"/>
      <metric name="success_rate" unit="percentage" type="gauge"/>
    </performance-metrics>
  </metric-definitions>

  <span-hierarchy>
    <root-span name="episode_production">
      <child-span name="initialization"/>
      <child-span name="research_phase">
        <child-span name="perplexity_search"/>
        <child-span name="source_verification"/>
        <child-span name="synthesis"/>
      </child-span>
      <child-span name="script_writing">
        <child-span name="narrative_generation"/>
        <child-span name="brand_alignment"/>
        <child-span name="revision"/>
      </child-span>
      <child-span name="quality_evaluation">
        <child-span name="llm_judge_evaluation"/>
        <child-span name="threshold_checking"/>
        <child-span name="decision"/>
      </child-span>
      <child-span name="audio_synthesis">
        <child-span name="text_preparation"/>
        <child-span name="voice_generation"/>
        <child-span name="post_processing"/>
      </child-span>
    </root-span>
  </span-hierarchy>

  <error-codes>
    <code value="E001" severity="critical">Budget exceeded</code>
    <code value="E002" severity="high">Quality gate failed</code>
    <code value="E003" severity="medium">API timeout</code>
    <code value="E004" severity="low">Retry attempted</code>
    <code value="E005" severity="critical">Token limit exceeded</code>
    <code value="E006" severity="high">Model unavailable</code>
    <code value="E007" severity="medium">Partial completion</code>
  </error-codes>

  <sampling-rules>
    <rule name="sample_all_errors" condition="error" rate="1.0"/>
    <rule name="sample_high_cost" condition="cost > 7.00" rate="1.0"/>
    <rule name="sample_low_quality" condition="quality &lt; 0.80" rate="1.0"/>
    <rule name="sample_success" condition="success" rate="0.1"/>
  </sampling-rules>

  <alerting-thresholds>
    <alert name="cost_overrun" condition="cost > max_episode_cost" severity="critical"/>
    <alert name="quality_degradation" condition="quality &lt; 0.80" severity="high"/>
    <alert name="high_retry_rate" condition="retry_rate > 0.3" severity="medium"/>
    <alert name="slow_production" condition="duration > 90 minutes" severity="low"/>
  </alerting-thresholds>
</document>
