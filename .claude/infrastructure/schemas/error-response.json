{
  "$schema": "https://json-schema.org/draft/2025-08/schema",
  "$id": "https://ai-podcasts-nobody-knows.com/schemas/error-response.json",
  "title": "Error Response Schema",
  "description": "Standardized error response schema for all AI podcast production agents",
  "allOf": [
    {
      "$ref": "./base-agent-response.json"
    }
  ],
  "properties": {
    "error_details": {
      "type": "object",
      "properties": {
        "error_id": {
          "type": "string",
          "pattern": "^error_\\d{8}_\\d{6}_[a-z0-9]{8}$",
          "description": "Unique error identifier with timestamp and random component",
          "examples": ["error_20250822_153045_a7b3c9d2"]
        },
        "error_category": {
          "type": "string",
          "enum": [
            "api_failure",
            "validation_error",
            "resource_exhaustion",
            "timeout",
            "authentication_error",
            "rate_limit_exceeded",
            "configuration_error",
            "data_corruption",
            "network_error",
            "permission_denied",
            "resource_not_found",
            "system_overload",
            "external_dependency_failure",
            "budget_exceeded",
            "quality_gate_failure",
            "consensus_failure",
            "agent_malfunction"
          ],
          "description": "Primary error category for classification and handling"
        },
        "error_severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low", "warning"],
          "description": "Error severity level affecting system operation"
        },
        "error_message": {
          "type": "string",
          "minLength": 1,
          "description": "Human-readable error description"
        },
        "technical_details": {
          "type": "object",
          "properties": {
            "stack_trace": {
              "type": "string",
              "description": "Technical stack trace if available"
            },
            "api_response_code": {
              "type": "integer",
              "description": "HTTP response code from API calls"
            },
            "api_response_body": {
              "type": "string",
              "description": "API response body for debugging"
            },
            "system_context": {
              "type": "object",
              "properties": {
                "memory_usage": {
                  "type": "number",
                  "description": "Memory usage at time of error (MB)"
                },
                "cpu_usage": {
                  "type": "number",
                  "description": "CPU usage at time of error (percentage)"
                },
                "available_budget": {
                  "type": "number",
                  "description": "Available budget at time of error (USD)"
                },
                "active_processes": {
                  "type": "integer",
                  "description": "Number of active processes"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "error_context": {
          "type": "object",
          "properties": {
            "operation_attempted": {
              "type": "string",
              "minLength": 1,
              "description": "What operation was being attempted when error occurred"
            },
            "input_data_summary": {
              "type": "string",
              "description": "Summary of input data that caused error"
            },
            "processing_stage": {
              "type": "string",
              "enum": [
                "initialization",
                "input_validation",
                "research_query",
                "content_generation",
                "quality_evaluation",
                "consensus_coordination",
                "output_formatting",
                "cost_tracking",
                "finalization"
              ],
              "description": "Processing stage where error occurred"
            },
            "related_agents": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9-]*[a-z0-9]$"
              },
              "description": "Other agents involved in the failed operation"
            }
          },
          "required": ["operation_attempted", "processing_stage"],
          "additionalProperties": false
        }
      },
      "required": ["error_id", "error_category", "error_severity", "error_message", "error_context"],
      "additionalProperties": false
    },
    "recovery_information": {
      "type": "object",
      "properties": {
        "recovery_attempted": {
          "type": "boolean",
          "description": "Whether automatic recovery was attempted"
        },
        "recovery_strategies": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "strategy_id": {
                "type": "string",
                "pattern": "^recovery_\\d{3}$"
              },
              "strategy_type": {
                "type": "string",
                "enum": [
                  "retry_with_backoff",
                  "fallback_model",
                  "reduce_complexity",
                  "budget_reallocation",
                  "alternative_approach",
                  "graceful_degradation",
                  "manual_intervention"
                ]
              },
              "strategy_description": {
                "type": "string",
                "minLength": 1
              },
              "attempt_timestamp": {
                "type": "string",
                "format": "date-time"
              },
              "recovery_result": {
                "type": "string",
                "enum": ["successful", "partial_success", "failed", "not_attempted"]
              },
              "result_details": {
                "type": "string",
                "description": "Details about recovery attempt outcome"
              }
            },
            "required": ["strategy_id", "strategy_type", "strategy_description", "attempt_timestamp", "recovery_result"],
            "additionalProperties": false
          }
        },
        "recovery_success": {
          "type": "boolean",
          "description": "Whether recovery was ultimately successful"
        },
        "fallback_data": {
          "type": "object",
          "description": "Any fallback data produced during recovery",
          "additionalProperties": true
        },
        "manual_intervention_required": {
          "type": "boolean",
          "description": "Whether manual intervention is needed"
        },
        "manual_intervention_guidance": {
          "type": "string",
          "description": "Guidance for manual intervention if needed"
        }
      },
      "required": ["recovery_attempted", "recovery_strategies", "recovery_success", "manual_intervention_required"],
      "additionalProperties": false
    },
    "impact_assessment": {
      "type": "object",
      "properties": {
        "workflow_impact": {
          "type": "string",
          "enum": ["blocking", "degraded", "minimal", "none"],
          "description": "Impact on overall workflow"
        },
        "data_integrity": {
          "type": "string",
          "enum": ["compromised", "potentially_affected", "intact", "unknown"],
          "description": "Assessment of data integrity"
        },
        "cost_impact": {
          "type": "object",
          "properties": {
            "wasted_budget": {
              "type": "number",
              "minimum": 0,
              "description": "Budget wasted due to error (USD)"
            },
            "recovery_cost": {
              "type": "number",
              "minimum": 0,
              "description": "Additional cost for recovery (USD)"
            },
            "total_impact": {
              "type": "number",
              "minimum": 0,
              "description": "Total financial impact (USD)"
            }
          },
          "required": ["wasted_budget", "recovery_cost", "total_impact"],
          "additionalProperties": false
        },
        "quality_impact": {
          "type": "string",
          "enum": ["severe", "moderate", "minimal", "none"],
          "description": "Impact on content quality"
        },
        "timeline_impact": {
          "type": "object",
          "properties": {
            "delay_minutes": {
              "type": "number",
              "minimum": 0,
              "description": "Delay caused by error (minutes)"
            },
            "recovery_time": {
              "type": "number",
              "minimum": 0,
              "description": "Time spent on recovery (minutes)"
            },
            "total_delay": {
              "type": "number",
              "minimum": 0,
              "description": "Total timeline impact (minutes)"
            }
          },
          "required": ["delay_minutes", "recovery_time", "total_delay"],
          "additionalProperties": false
        }
      },
      "required": ["workflow_impact", "data_integrity", "cost_impact", "quality_impact", "timeline_impact"],
      "additionalProperties": false
    },
    "monitoring_data": {
      "type": "object",
      "properties": {
        "error_frequency": {
          "type": "object",
          "properties": {
            "similar_errors_today": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of similar errors today"
            },
            "similar_errors_week": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of similar errors this week"
            },
            "error_trend": {
              "type": "string",
              "enum": ["increasing", "stable", "decreasing", "first_occurrence"],
              "description": "Trend in error frequency"
            }
          },
          "required": ["similar_errors_today", "similar_errors_week", "error_trend"],
          "additionalProperties": false
        },
        "system_health": {
          "type": "object",
          "properties": {
            "overall_system_status": {
              "type": "string",
              "enum": ["healthy", "degraded", "critical", "failing"],
              "description": "Overall system health at time of error"
            },
            "recent_error_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Recent error rate (errors per operation)"
            },
            "system_load": {
              "type": "string",
              "enum": ["low", "normal", "high", "overloaded"],
              "description": "System load at time of error"
            }
          },
          "required": ["overall_system_status", "recent_error_rate", "system_load"],
          "additionalProperties": false
        },
        "alerting_information": {
          "type": "object",
          "properties": {
            "alert_triggered": {
              "type": "boolean",
              "description": "Whether this error triggered an alert"
            },
            "alert_level": {
              "type": "string",
              "enum": ["info", "warning", "error", "critical"],
              "description": "Level of alert triggered"
            },
            "notification_sent": {
              "type": "boolean",
              "description": "Whether notifications were sent"
            },
            "escalation_required": {
              "type": "boolean",
              "description": "Whether this error requires escalation"
            }
          },
          "required": ["alert_triggered", "notification_sent", "escalation_required"],
          "additionalProperties": false
        }
      },
      "required": ["error_frequency", "system_health", "alerting_information"],
      "additionalProperties": false
    },
    "resolution_guidance": {
      "type": "object",
      "properties": {
        "immediate_actions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "action_id": {
                "type": "string",
                "pattern": "^action_\\d{3}$"
              },
              "action_type": {
                "type": "string",
                "enum": [
                  "retry_operation",
                  "check_configuration",
                  "verify_credentials",
                  "restart_service",
                  "contact_support",
                  "check_budget",
                  "review_logs",
                  "validate_input"
                ]
              },
              "description": {
                "type": "string",
                "minLength": 1
              },
              "priority": {
                "type": "string",
                "enum": ["critical", "high", "medium", "low"]
              },
              "estimated_time": {
                "type": "string",
                "pattern": "^\\d+_(minutes|hours)$",
                "description": "Estimated time to complete action"
              }
            },
            "required": ["action_id", "action_type", "description", "priority", "estimated_time"],
            "additionalProperties": false
          }
        },
        "preventive_measures": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "measure_id": {
                "type": "string",
                "pattern": "^measure_\\d{3}$"
              },
              "measure_type": {
                "type": "string",
                "enum": [
                  "input_validation",
                  "resource_monitoring",
                  "configuration_review",
                  "dependency_upgrade",
                  "capacity_planning",
                  "redundancy_implementation",
                  "monitoring_enhancement"
                ]
              },
              "description": {
                "type": "string",
                "minLength": 1
              },
              "implementation_priority": {
                "type": "string",
                "enum": ["immediate", "short_term", "medium_term", "long_term"]
              },
              "expected_benefit": {
                "type": "string",
                "minLength": 1
              }
            },
            "required": ["measure_id", "measure_type", "description", "implementation_priority", "expected_benefit"],
            "additionalProperties": false
          }
        },
        "documentation_links": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "title": {
                "type": "string",
                "minLength": 1
              },
              "url": {
                "type": "string",
                "format": "uri"
              },
              "relevance": {
                "type": "string",
                "enum": ["high", "medium", "low"]
              }
            },
            "required": ["title", "url", "relevance"],
            "additionalProperties": false
          }
        }
      },
      "required": ["immediate_actions", "preventive_measures", "documentation_links"],
      "additionalProperties": false
    }
  },
  "required": ["error_details", "recovery_information", "impact_assessment", "monitoring_data", "resolution_guidance"],
  "additionalProperties": false
}
