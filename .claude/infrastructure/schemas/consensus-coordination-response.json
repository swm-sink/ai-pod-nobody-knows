{
  "$schema": "https://json-schema.org/draft/2025-08/schema",
  "$id": "https://ai-podcasts-nobody-knows.com/schemas/consensus-coordination-response.json",
  "title": "Consensus Coordination Response Schema",
  "description": "Schema for three-evaluator consensus system coordination and final decision making",
  "allOf": [
    {
      "$ref": "./base-agent-response.json"
    }
  ],
  "properties": {
    "consensus_configuration": {
      "type": "object",
      "properties": {
        "evaluator_weights": {
          "type": "object",
          "properties": {
            "claude_weight": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Weight for Claude evaluator (default: 0.35)"
            },
            "gemini_weight": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Weight for Gemini evaluator (default: 0.30)"
            },
            "perplexity_weight": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Weight for Perplexity evaluator (default: 0.35)"
            }
          },
          "required": ["claude_weight", "gemini_weight", "perplexity_weight"],
          "additionalProperties": false
        },
        "consensus_thresholds": {
          "type": "object",
          "properties": {
            "advancement_threshold": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Minimum consensus score for advancement"
            },
            "high_confidence_threshold": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Threshold for high confidence consensus"
            },
            "disagreement_threshold": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Score difference indicating significant disagreement"
            }
          },
          "required": ["advancement_threshold", "high_confidence_threshold", "disagreement_threshold"],
          "additionalProperties": false
        },
        "consensus_requirements": {
          "type": "object",
          "properties": {
            "critical_issue_unanimity": {
              "type": "boolean",
              "description": "Whether critical issues require unanimous agreement"
            },
            "advancement_majority": {
              "type": "boolean",
              "description": "Whether advancement requires majority agreement"
            },
            "quality_gate_strictness": {
              "type": "string",
              "enum": ["strict", "balanced", "permissive"],
              "description": "Quality gate enforcement level"
            }
          },
          "required": ["critical_issue_unanimity", "advancement_majority", "quality_gate_strictness"],
          "additionalProperties": false
        }
      },
      "required": ["evaluator_weights", "consensus_thresholds", "consensus_requirements"],
      "additionalProperties": false
    },
    "evaluator_inputs": {
      "type": "object",
      "properties": {
        "claude_evaluation": {
          "type": "object",
          "properties": {
            "received": {
              "type": "boolean",
              "description": "Whether Claude evaluation was received"
            },
            "overall_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "advancement_status": {
              "type": "string",
              "enum": ["approved", "conditional_approval", "revision_required", "major_rework_needed"]
            },
            "confidence": {
              "type": "string",
              "enum": ["high", "medium", "low"]
            },
            "critical_issues": {
              "type": "integer",
              "minimum": 0
            },
            "specialization_scores": {
              "type": "object",
              "additionalProperties": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          },
          "required": ["received", "overall_score", "advancement_status", "confidence", "critical_issues"],
          "additionalProperties": false
        },
        "gemini_evaluation": {
          "type": "object",
          "properties": {
            "received": {
              "type": "boolean",
              "description": "Whether Gemini evaluation was received"
            },
            "overall_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "advancement_status": {
              "type": "string",
              "enum": ["approved", "conditional_approval", "revision_required", "major_rework_needed"]
            },
            "confidence": {
              "type": "string",
              "enum": ["high", "medium", "low"]
            },
            "critical_issues": {
              "type": "integer",
              "minimum": 0
            },
            "specialization_scores": {
              "type": "object",
              "additionalProperties": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          },
          "required": ["received", "overall_score", "advancement_status", "confidence", "critical_issues"],
          "additionalProperties": false
        },
        "perplexity_evaluation": {
          "type": "object",
          "properties": {
            "received": {
              "type": "boolean",
              "description": "Whether Perplexity evaluation was received"
            },
            "overall_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "advancement_status": {
              "type": "string",
              "enum": ["approved", "conditional_approval", "revision_required", "major_rework_needed"]
            },
            "confidence": {
              "type": "string",
              "enum": ["high", "medium", "low"]
            },
            "critical_issues": {
              "type": "integer",
              "minimum": 0
            },
            "specialization_scores": {
              "type": "object",
              "additionalProperties": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          },
          "required": ["received", "overall_score", "advancement_status", "confidence", "critical_issues"],
          "additionalProperties": false
        }
      },
      "required": ["claude_evaluation", "gemini_evaluation", "perplexity_evaluation"],
      "additionalProperties": false
    },
    "consensus_analysis": {
      "type": "object",
      "properties": {
        "weighted_consensus_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Final weighted consensus quality score"
        },
        "consensus_confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "Confidence level in consensus decision"
        },
        "agreement_analysis": {
          "type": "object",
          "properties": {
            "score_variance": {
              "type": "number",
              "minimum": 0,
              "description": "Variance in evaluator scores"
            },
            "advancement_agreement": {
              "type": "string",
              "enum": ["unanimous", "majority", "split", "conflicted"],
              "description": "Level of agreement on advancement decision"
            },
            "critical_issues_agreement": {
              "type": "string",
              "enum": ["unanimous", "majority", "split", "conflicted"],
              "description": "Level of agreement on critical issues"
            },
            "confidence_alignment": {
              "type": "string",
              "enum": ["aligned", "mostly_aligned", "mixed", "conflicted"],
              "description": "Alignment of evaluator confidence levels"
            }
          },
          "required": ["score_variance", "advancement_agreement", "critical_issues_agreement", "confidence_alignment"],
          "additionalProperties": false
        },
        "disagreement_analysis": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "disagreement_id": {
                "type": "string",
                "pattern": "^disagree_\\d{3}$"
              },
              "category": {
                "type": "string",
                "enum": [
                  "score_discrepancy",
                  "advancement_conflict",
                  "critical_issue_disagreement",
                  "confidence_mismatch",
                  "specialization_conflict"
                ]
              },
              "evaluators_involved": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["claude", "gemini", "perplexity"]
                },
                "minItems": 2,
                "maxItems": 3
              },
              "disagreement_magnitude": {
                "type": "string",
                "enum": ["minor", "moderate", "significant", "major"]
              },
              "resolution_strategy": {
                "type": "string",
                "enum": [
                  "weighted_average",
                  "conservative_approach",
                  "majority_rule",
                  "highest_confidence",
                  "specialist_deference",
                  "manual_review_required"
                ]
              },
              "resolution_outcome": {
                "type": "string",
                "minLength": 1
              }
            },
            "required": ["disagreement_id", "category", "evaluators_involved", "disagreement_magnitude", "resolution_strategy", "resolution_outcome"],
            "additionalProperties": false
          }
        }
      },
      "required": ["weighted_consensus_score", "consensus_confidence", "agreement_analysis", "disagreement_analysis"],
      "additionalProperties": false
    },
    "final_decision": {
      "type": "object",
      "properties": {
        "advancement_decision": {
          "type": "string",
          "enum": ["approved", "conditional_approval", "revision_required", "major_rework_needed", "evaluation_failed"],
          "description": "Final consensus decision on script advancement"
        },
        "decision_rationale": {
          "type": "string",
          "minLength": 1,
          "description": "Explanation of how consensus decision was reached"
        },
        "critical_requirements": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "requirement_id": {
                "type": "string",
                "pattern": "^req_\\d{3}$"
              },
              "category": {
                "type": "string",
                "enum": [
                  "content_accuracy",
                  "technical_compliance",
                  "brand_voice_alignment",
                  "production_readiness",
                  "research_validation"
                ]
              },
              "description": {
                "type": "string",
                "minLength": 1
              },
              "priority": {
                "type": "string",
                "enum": ["blocking", "critical", "important", "recommended"]
              },
              "consensus_level": {
                "type": "string",
                "enum": ["unanimous", "majority", "specialist_identified"]
              }
            },
            "required": ["requirement_id", "category", "description", "priority", "consensus_level"],
            "additionalProperties": false
          }
        },
        "improvement_priorities": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "priority_id": {
                "type": "string",
                "pattern": "^priority_\\d{3}$"
              },
              "category": {
                "type": "string",
                "enum": [
                  "content_accuracy",
                  "narrative_coherence",
                  "brand_voice_alignment",
                  "engagement_optimization",
                  "technical_compliance",
                  "production_readiness"
                ]
              },
              "description": {
                "type": "string",
                "minLength": 1
              },
              "expected_impact": {
                "type": "string",
                "enum": ["high", "medium", "low"]
              },
              "consensus_strength": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Strength of consensus on this priority"
              },
              "implementation_effort": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              }
            },
            "required": ["priority_id", "category", "description", "expected_impact", "consensus_strength", "implementation_effort"],
            "additionalProperties": false
          }
        },
        "quality_gates_status": {
          "type": "object",
          "properties": {
            "content_quality_gate": {
              "type": "string",
              "enum": ["passed", "conditional", "failed", "not_evaluated"]
            },
            "technical_quality_gate": {
              "type": "string",
              "enum": ["passed", "conditional", "failed", "not_evaluated"]
            },
            "brand_voice_gate": {
              "type": "string",
              "enum": ["passed", "conditional", "failed", "not_evaluated"]
            },
            "research_accuracy_gate": {
              "type": "string",
              "enum": ["passed", "conditional", "failed", "not_evaluated"]
            },
            "production_readiness_gate": {
              "type": "string",
              "enum": ["passed", "conditional", "failed", "not_evaluated"]
            }
          },
          "required": ["content_quality_gate", "technical_quality_gate", "brand_voice_gate", "research_accuracy_gate", "production_readiness_gate"],
          "additionalProperties": false
        }
      },
      "required": ["advancement_decision", "decision_rationale", "critical_requirements", "improvement_priorities", "quality_gates_status"],
      "additionalProperties": false
    },
    "system_feedback": {
      "type": "object",
      "properties": {
        "consensus_effectiveness": {
          "type": "object",
          "properties": {
            "decision_confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "System confidence in consensus decision"
            },
            "evaluator_agreement": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Level of evaluator agreement"
            },
            "process_efficiency": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Efficiency of consensus process"
            },
            "quality_outcome": {
              "type": "string",
              "enum": ["excellent", "good", "adequate", "concerning"],
              "description": "Assessment of quality outcome"
            }
          },
          "required": ["decision_confidence", "evaluator_agreement", "process_efficiency", "quality_outcome"],
          "additionalProperties": false
        },
        "calibration_recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "recommendation_id": {
                "type": "string",
                "pattern": "^calib_\\d{3}$"
              },
              "target_component": {
                "type": "string",
                "enum": ["claude_evaluator", "gemini_evaluator", "perplexity_evaluator", "consensus_weights", "quality_thresholds", "process_efficiency"]
              },
              "recommendation_type": {
                "type": "string",
                "enum": ["weight_adjustment", "threshold_modification", "process_improvement", "training_needed", "bias_correction"]
              },
              "description": {
                "type": "string",
                "minLength": 1
              },
              "expected_benefit": {
                "type": "string",
                "minLength": 1
              },
              "implementation_priority": {
                "type": "string",
                "enum": ["immediate", "next_episode", "next_iteration", "future_consideration"]
              }
            },
            "required": ["recommendation_id", "target_component", "recommendation_type", "description", "expected_benefit", "implementation_priority"],
            "additionalProperties": false
          }
        },
        "learning_insights": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "insight_id": {
                "type": "string",
                "pattern": "^insight_\\d{3}$"
              },
              "category": {
                "type": "string",
                "enum": ["evaluator_performance", "consensus_patterns", "quality_trends", "disagreement_patterns", "system_reliability"]
              },
              "description": {
                "type": "string",
                "minLength": 1
              },
              "actionable": {
                "type": "boolean",
                "description": "Whether this insight suggests specific actions"
              },
              "significance": {
                "type": "string",
                "enum": ["high", "medium", "low"]
              }
            },
            "required": ["insight_id", "category", "description", "actionable", "significance"],
            "additionalProperties": false
          }
        }
      },
      "required": ["consensus_effectiveness", "calibration_recommendations", "learning_insights"],
      "additionalProperties": false
    }
  },
  "required": ["consensus_configuration", "evaluator_inputs", "consensus_analysis", "final_decision", "system_feedback"],
  "additionalProperties": false
}
