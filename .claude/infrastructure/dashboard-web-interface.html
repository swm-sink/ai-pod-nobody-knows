<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nobody Knows - AI Podcast Production Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f23;
            color: #cccccc;
            line-height: 1.6;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: 80px 1fr;
            grid-template-areas:
                "sidebar header"
                "sidebar main";
            min-height: 100vh;
        }

        .header {
            grid-area: header;
            background: #1a1a2e;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
        }

        .header h1 {
            color: #00d4aa;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00d4aa;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .sidebar {
            grid-area: sidebar;
            background: #16213e;
            padding: 1rem;
            border-right: 1px solid #333;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-menu li {
            margin-bottom: 0.5rem;
        }

        .nav-menu a {
            color: #cccccc;
            text-decoration: none;
            padding: 0.75rem;
            display: block;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background: #00d4aa20;
            color: #00d4aa;
        }

        .main-content {
            grid-area: main;
            padding: 2rem;
            overflow-y: auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 170, 0.1);
        }

        .card h3 {
            color: #00d4aa;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: #888;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4aa, #00a085);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .episode-queue {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .episode-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            margin: 0.5rem 0;
            background: #0f0f23;
            border-radius: 6px;
            border-left: 4px solid #00d4aa;
        }

        .episode-info h4 {
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .episode-meta {
            color: #888;
            font-size: 0.9rem;
        }

        .phase-indicators {
            display: flex;
            gap: 0.5rem;
        }

        .phase-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            position: relative;
        }

        .phase-dot.completed {
            background: #00d4aa;
        }

        .phase-dot.active {
            background: #ffa500;
            animation: pulse 1.5s infinite;
        }

        .phase-dot.error {
            background: #ff6b6b;
        }

        .chart-container {
            width: 100%;
            height: 200px;
            margin: 1rem 0;
            background: #0f0f23;
            border-radius: 6px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
        }

        .quality-meter {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .quality-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quality-score {
            font-weight: bold;
        }

        .quality-score.excellent {
            color: #00d4aa;
        }

        .quality-score.good {
            color: #ffa500;
        }

        .quality-score.needs-improvement {
            color: #ff6b6b;
        }

        .cost-breakdown {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            margin: 1rem 0;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background: #0f0f23;
            border-radius: 4px;
        }

        .alert-banner {
            background: #ff6b6b20;
            border: 1px solid #ff6b6b;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #ff6b6b;
            display: none;
        }

        .alert-banner.show {
            display: block;
        }

        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00d4aa;
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .refresh-indicator.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-rows: 80px 60px 1fr;
                grid-template-areas:
                    "header"
                    "sidebar"
                    "main";
            }

            .sidebar {
                overflow-x: auto;
                padding: 0.5rem 1rem;
            }

            .nav-menu {
                display: flex;
                gap: 1rem;
            }

            .nav-menu li {
                margin-bottom: 0;
                white-space: nowrap;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header">
            <h1>üéì Nobody Knows Dashboard</h1>
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Live</span>
                <span id="lastUpdate"></span>
            </div>
        </header>

        <nav class="sidebar">
            <ul class="nav-menu">
                <li><a href="#overview" class="active">üìä Overview</a></li>
                <li><a href="#production">üé¨ Production</a></li>
                <li><a href="#quality">‚≠ê Quality</a></li>
                <li><a href="#costs">üí∞ Costs</a></li>
                <li><a href="#performance">‚ö° Performance</a></li>
                <li><a href="#errors">üö® Errors</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div id="alertBanner" class="alert-banner">
                <strong>‚ö†Ô∏è Alert:</strong> <span id="alertMessage"></span>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <h3>üé¨ Episodes in Production</h3>
                    <div class="metric-value" id="episodesInProduction">0</div>
                    <div class="metric-label">Active episodes</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="productionProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>‚≠ê Average Quality Score</h3>
                    <div class="metric-value" id="avgQuality">0.00</div>
                    <div class="metric-label">Brand voice & technical accuracy</div>
                </div>

                <div class="card">
                    <h3>üí∞ Episode Cost</h3>
                    <div class="metric-value" id="episodeCost">$0.00</div>
                    <div class="metric-label">Current episode / $25.75 budget</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="costProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>‚ö° System Performance</h3>
                    <div class="metric-value" id="avgResponseTime">0ms</div>
                    <div class="metric-label">Average response time</div>
                </div>
            </div>

            <div class="episode-queue">
                <h3>üìã Production Pipeline</h3>
                <div id="episodeList">
                    <div class="episode-item">
                        <div class="episode-info">
                            <h4>Loading episodes...</h4>
                            <div class="episode-meta">Fetching production data</div>
                        </div>
                        <div class="phase-indicators">
                            <div class="phase-dot"></div>
                            <div class="phase-dot"></div>
                            <div class="phase-dot"></div>
                            <div class="phase-dot"></div>
                            <div class="phase-dot"></div>
                            <div class="phase-dot"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <h3>üìà Quality Trends</h3>
                    <div class="quality-meter">
                        <div class="quality-item">
                            <span>Brand Voice Consistency</span>
                            <span class="quality-score" id="brandVoiceScore">0.00</span>
                        </div>
                        <div class="quality-item">
                            <span>Technical Accuracy</span>
                            <span class="quality-score" id="technicalScore">0.00</span>
                        </div>
                        <div class="quality-item">
                            <span>Consensus Confidence</span>
                            <span class="quality-score" id="consensusScore">0.00</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üí∏ Cost Breakdown</h3>
                    <div class="cost-breakdown" id="costBreakdown">
                        <div class="cost-item">
                            <span>Research</span>
                            <span id="researchCost">$0.00</span>
                        </div>
                        <div class="cost-item">
                            <span>Script Writing</span>
                            <span id="scriptCost">$0.00</span>
                        </div>
                        <div class="cost-item">
                            <span>Quality Consensus</span>
                            <span id="consensusCost">$0.00</span>
                        </div>
                        <div class="cost-item">
                            <span>TTS & Audio</span>
                            <span id="audioCost">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="refreshIndicator" class="refresh-indicator">
        üîÑ Updating...
    </div>

    <script>
        class PodcastDashboard {
            constructor() {
                this.refreshInterval = 2000; // 2 second refresh
                this.isUpdating = false;
                this.lastUpdateTime = null;
                this.websocket = null;

                this.init();
            }

            init() {
                this.setupWebSocket();
                this.setupPeriodicRefresh();
                this.setupNavigation();
                this.loadDashboardData();
            }

            setupWebSocket() {
                // Attempt WebSocket connection for real-time updates
                try {
                    const wsUrl = `ws://${window.location.host}/dashboard/ws`;
                    this.websocket = new WebSocket(wsUrl);

                    this.websocket.onopen = () => {
                        console.log('WebSocket connected');
                        this.updateStatusIndicator(true);
                    };

                    this.websocket.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleRealtimeUpdate(data);
                    };

                    this.websocket.onclose = () => {
                        console.log('WebSocket disconnected, falling back to polling');
                        this.updateStatusIndicator(false);
                    };

                    this.websocket.onerror = () => {
                        console.log('WebSocket error, using polling only');
                        this.updateStatusIndicator(false);
                    };
                } catch (error) {
                    console.log('WebSocket not available, using polling');
                    this.updateStatusIndicator(false);
                }
            }

            setupPeriodicRefresh() {
                setInterval(() => {
                    if (!this.isUpdating) {
                        this.loadDashboardData();
                    }
                }, this.refreshInterval);
            }

            setupNavigation() {
                const navLinks = document.querySelectorAll('.nav-menu a');
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        navLinks.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');

                        const section = link.getAttribute('href').substring(1);
                        this.showSection(section);
                    });
                });
            }

            async loadDashboardData() {
                this.showRefreshIndicator();
                this.isUpdating = true;

                try {
                    // Load metrics data
                    const metricsResponse = await this.fetchWithFallback('/dashboard/api/metrics');
                    if (metricsResponse) {
                        this.updateMetrics(metricsResponse);
                    }

                    // Load production data
                    const productionResponse = await this.fetchWithFallback('/dashboard/api/production');
                    if (productionResponse) {
                        this.updateProduction(productionResponse);
                    }

                    // Load quality data
                    const qualityResponse = await this.fetchWithFallback('/dashboard/api/quality');
                    if (qualityResponse) {
                        this.updateQuality(qualityResponse);
                    }

                    // Load cost data
                    const costResponse = await this.fetchWithFallback('/dashboard/api/costs');
                    if (costResponse) {
                        this.updateCosts(costResponse);
                    }

                    this.lastUpdateTime = new Date();
                    this.updateLastUpdateTime();

                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                    this.showAlert('Failed to load dashboard data. Using simulated data.');
                    this.loadSimulatedData();
                } finally {
                    this.isUpdating = false;
                    this.hideRefreshIndicator();
                }
            }

            async fetchWithFallback(url) {
                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        return await response.json();
                    }
                    throw new Error(`HTTP ${response.status}`);
                } catch (error) {
                    console.warn(`API call failed: ${url}`, error);
                    return null;
                }
            }

            loadSimulatedData() {
                // Simulate realistic dashboard data for demonstration
                const simulatedMetrics = {
                    episodes_in_production: Math.floor(Math.random() * 3) + 1,
                    production_progress: Math.random() * 80 + 20,
                    avg_quality: 0.82 + Math.random() * 0.15,
                    episode_cost: 4.25 + Math.random() * 2.5,
                    avg_response_time: Math.floor(Math.random() * 500) + 200
                };

                const simulatedProduction = {
                    active_episodes: [
                        {
                            episode_id: 'ep_2025_001',
                            title: 'The Future of AI Development',
                            current_phase: 'script-development',
                            progress: 45,
                            phases: {
                                'research-excellence': 'completed',
                                'script-development': 'active',
                                'three-evaluator-consensus': 'pending',
                                'tts-optimization': 'pending',
                                'audio-synthesis': 'pending',
                                'final-validation': 'pending'
                            }
                        }
                    ]
                };

                const simulatedQuality = {
                    brand_voice_score: 0.87,
                    technical_score: 0.91,
                    consensus_confidence: 0.78
                };

                const simulatedCosts = {
                    research_cost: 1.85,
                    script_cost: 1.20,
                    consensus_cost: 0.95,
                    audio_cost: 5.15,
                    total_cost: 9.15
                };

                this.updateMetrics(simulatedMetrics);
                this.updateProduction(simulatedProduction);
                this.updateQuality(simulatedQuality);
                this.updateCosts(simulatedCosts);
            }

            updateMetrics(data) {
                document.getElementById('episodesInProduction').textContent = data.episodes_in_production || 0;
                document.getElementById('avgQuality').textContent = (data.avg_quality || 0).toFixed(2);
                document.getElementById('episodeCost').textContent = `$${(data.episode_cost || 0).toFixed(2)}`;
                document.getElementById('avgResponseTime').textContent = `${data.avg_response_time || 0}ms`;

                // Update progress bars
                const productionProgress = document.getElementById('productionProgress');
                const costProgress = document.getElementById('costProgress');

                if (productionProgress) {
                    productionProgress.style.width = `${data.production_progress || 0}%`;
                }

                if (costProgress) {
                    const costPercentage = ((data.episode_cost || 0) / 25.75) * 100;
                    costProgress.style.width = `${Math.min(costPercentage, 100)}%`;

                    // Change color based on cost level
                    if (costPercentage > 80) {
                        costProgress.style.background = 'linear-gradient(90deg, #ff6b6b, #e74c3c)';
                    } else if (costPercentage > 60) {
                        costProgress.style.background = 'linear-gradient(90deg, #ffa500, #ff8c00)';
                    } else {
                        costProgress.style.background = 'linear-gradient(90deg, #00d4aa, #00a085)';
                    }
                }
            }

            updateProduction(data) {
                const episodeList = document.getElementById('episodeList');
                if (!data.active_episodes || data.active_episodes.length === 0) {
                    episodeList.innerHTML = `
                        <div class="episode-item">
                            <div class="episode-info">
                                <h4>No active episodes</h4>
                                <div class="episode-meta">Production queue is empty</div>
                            </div>
                            <div class="phase-indicators">
                                <div class="phase-dot"></div>
                                <div class="phase-dot"></div>
                                <div class="phase-dot"></div>
                                <div class="phase-dot"></div>
                                <div class="phase-dot"></div>
                                <div class="phase-dot"></div>
                            </div>
                        </div>
                    `;
                    return;
                }

                episodeList.innerHTML = data.active_episodes.map(episode => {
                    const phases = ['research-excellence', 'script-development', 'three-evaluator-consensus',
                                  'tts-optimization', 'audio-synthesis', 'final-validation'];

                    const phaseIndicators = phases.map(phase => {
                        const status = episode.phases[phase] || 'pending';
                        let className = 'phase-dot';

                        if (status === 'completed') className += ' completed';
                        else if (status === 'active') className += ' active';
                        else if (status === 'error') className += ' error';

                        return `<div class="${className}" title="${phase}"></div>`;
                    }).join('');

                    return `
                        <div class="episode-item">
                            <div class="episode-info">
                                <h4>${episode.title || episode.episode_id}</h4>
                                <div class="episode-meta">
                                    ${episode.episode_id} ‚Ä¢ ${episode.current_phase} ‚Ä¢ ${episode.progress}%
                                </div>
                            </div>
                            <div class="phase-indicators">
                                ${phaseIndicators}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            updateQuality(data) {
                const brandVoiceScore = document.getElementById('brandVoiceScore');
                const technicalScore = document.getElementById('technicalScore');
                const consensusScore = document.getElementById('consensusScore');

                if (brandVoiceScore) {
                    brandVoiceScore.textContent = (data.brand_voice_score || 0).toFixed(2);
                    brandVoiceScore.className = `quality-score ${this.getQualityClass(data.brand_voice_score)}`;
                }

                if (technicalScore) {
                    technicalScore.textContent = (data.technical_score || 0).toFixed(2);
                    technicalScore.className = `quality-score ${this.getQualityClass(data.technical_score)}`;
                }

                if (consensusScore) {
                    consensusScore.textContent = (data.consensus_confidence || 0).toFixed(2);
                    consensusScore.className = `quality-score ${this.getQualityClass(data.consensus_confidence)}`;
                }
            }

            updateCosts(data) {
                document.getElementById('researchCost').textContent = `$${(data.research_cost || 0).toFixed(2)}`;
                document.getElementById('scriptCost').textContent = `$${(data.script_cost || 0).toFixed(2)}`;
                document.getElementById('consensusCost').textContent = `$${(data.consensus_cost || 0).toFixed(2)}`;
                document.getElementById('audioCost').textContent = `$${(data.audio_cost || 0).toFixed(2)}`;
            }

            getQualityClass(score) {
                if (score >= 0.85) return 'excellent';
                if (score >= 0.70) return 'good';
                return 'needs-improvement';
            }

            handleRealtimeUpdate(data) {
                console.log('Real-time update received:', data);

                if (data.type === 'production_phase_update') {
                    this.loadDashboardData();
                } else if (data.type === 'quality_alert') {
                    this.showAlert(`Quality alert: ${data.message}`);
                } else if (data.type === 'cost_warning') {
                    this.showAlert(`Cost warning: ${data.message}`);
                } else if (data.type === 'error_notification') {
                    this.showAlert(`System error: ${data.message}`);
                }
            }

            showAlert(message) {
                const alertBanner = document.getElementById('alertBanner');
                const alertMessage = document.getElementById('alertMessage');

                alertMessage.textContent = message;
                alertBanner.classList.add('show');

                setTimeout(() => {
                    alertBanner.classList.remove('show');
                }, 10000);
            }

            showRefreshIndicator() {
                const indicator = document.getElementById('refreshIndicator');
                indicator.classList.add('show');
            }

            hideRefreshIndicator() {
                const indicator = document.getElementById('refreshIndicator');
                setTimeout(() => indicator.classList.remove('show'), 300);
            }

            updateStatusIndicator(connected) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');

                if (connected) {
                    statusDot.style.background = '#00d4aa';
                    statusText.textContent = 'Live';
                } else {
                    statusDot.style.background = '#ffa500';
                    statusText.textContent = 'Polling';
                }
            }

            updateLastUpdateTime() {
                const lastUpdate = document.getElementById('lastUpdate');
                if (this.lastUpdateTime) {
                    const timeAgo = Math.floor((Date.now() - this.lastUpdateTime.getTime()) / 1000);
                    lastUpdate.textContent = `‚Ä¢ ${timeAgo}s ago`;
                }
            }

            showSection(section) {
                // Implementation for showing different dashboard sections
                console.log(`Showing section: ${section}`);
            }
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new PodcastDashboard();
        });
    </script>
</body>
</html>
